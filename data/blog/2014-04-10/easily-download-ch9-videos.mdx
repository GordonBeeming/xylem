---
title: 'Easily download Ch9 videos'
date: 2014-04-10
tags: ['Channel 9', 'PowerShell']
draft: false
summary: 'I watch and download a lot of videos from Channel 9 and because I’m a developer and always looking for ways to speed up anything I do I searched for a PowerShell script. I eventually found one (can’t remember where) and immediately set it up to download This Week on Channel 9 and Ping Show. Over time I have added many other shows, events and series. The initial script I was found with some modifications was'
---


I watch and download a lot of videos from [Channel 9](http://channel9.msdn.com) and because I’m a developer and always looking for ways to speed up anything I do I searched for a PowerShell script. I eventually found one (can’t remember where) and immediately set it up to download [This Week on Channel 9](http://channel9.msdn.com/Shows/This+Week+On+Channel+9) and [Ping Show](http://channel9.msdn.com/Shows/PingShow). Over time I have added many other shows, events and series. The initial script I was found with some modifications was 
 
```powershell
$url="http://channel9.msdn.com/Shows/This+Week+On+Channel+9/feed/mp4high"$rss=invoke-webrequest -uri $url $destination="Z:\Media\Videos\ch9\This Week on ch9\"[xml]$rss.Content|foreach{   $_.SelectNodes("rss/channel/item/enclosure") }|foreach{     "Checking $($_.url.split("/")[-1]), we will skip it if it already exists in $($destination)"  if(!(test-path ($destination + $_.url.split("/")[-1]))){     "Downloading: " + $_.url     start-bitstransfer $_.url $destination  } }
```

Because of the amount of shows growing that I was interested in I added another piece to this. On the root level of all my Channel 9 videos I added a PowerShell file that would run all the other PowerShell files that looked like

```powershell
cd Z:\Media\Videos\ch9$psScripts = Get-ChildItem -Recurse -Filter "*.ps1" | ForEach-Object -Process { if($_.Name -ne "Download All.ps1"){ Write-Text "$($_.Name)"; . $_.FullName; } }Write-Output "Done"
```

This was working great as I wouldn’t need to go and run multiple files in order to update all my videos. Recently because of all the new stuff that was released because of the announcements  at [#VS2013Launch](https://twitter.com/search?src=typd&amp;q=vs2013launch) I had to add about 5 new feeds to my collection. This took quite a while as I needed to create a new folder for the show, then get a copy of the first PowerShell script above and then alter the feed url and location to save the videos to. This lead to yet another script, the way I saw it I could either write a script that automates the create of the folder and script or I could do the longer but right thing and start “fresh”. The script I now run takes in an array of the url of the show, series, event or any other type of channel that has an RSS feed, basically everything after [http://channel9.msdn.com/](http://channel9.msdn.com/). The new and improved script looks like

```powershell
clsWrite-Output "Starting"$feedTypeNameList = $("Events/Build/2014",                         "Shows/PingShow",                        "Shows/This+Week+On+Channel+9",                         "Series/Microsoft-Research-Luminaries",                        "Shows/Windows-Azure-Friday",                        "Blogs/One-Dev-Minute",                        "Shows/Visual-Studio-Toolbox",                        "Events/Visual-Studio/Launch-2013",                        "Series/Application-Insights-for-Visual-Studio-Online",                        "Series/Visual-Studio-Online",                        "Series/Visual-Studio-Online-Monaco",                        "Series/Visual-Studio-2012-Premium-and-Ultimate-Overview",                         "Blogs/MadsKristensen",                         "Blogs/C9Team",                         "Series/PerfView-Tutorial",                        "Blogs/IE",                        "Shows/Edge")$baseSaveLocation = "N:\s\ch9`$"$mediaFormat = "high"$mediaType = "mp4"$fileExtension = "mp4"$pathToRemoveInvalidFileNameCharsScript = "$baseSaveLocation\Remove-InvalidFileNameChars.ps1"#------------Don't edit below here----------------#. "$pathToRemoveInvalidFileNameCharsScript"foreach($feedTypeName in $feedTypeNameList){    $channelType = $feedTypeName.Split("/")[0]    $feedUrl="http://channel9.msdn.com/$($feedTypeName.Trim("/"))/RSS/$($mediaType + $mediaFormat)"    Write-Output @"        Downloading Feed: $feedUrl"@    $rss=invoke-webrequest -uri $feedUrl    $destination="$baseSaveLocation\$($feedTypeName.Replace("/","\").Trim("\"))\"    if (!(Test-Path $destination)) {        New-Item -ItemType directory -Path $destination    }    $videos = @()    [xml]$rss.Content|foreach{         $_.SelectNodes("rss/channel/item")|foreach{             [Array]$array = @($_.SelectSingleNode("enclosure").url,$_.SelectSingleNode("title").InnerText)            $videos += , $array        }    }       [Array]::Reverse($videos)    foreach($video in $videos){         $url = $video[0]        $title = $video[1]        if (![string]::IsNullOrEmpty("$url"))        {            $fileName = $($url.split("/")[-1])            $mp4fileName = $($fileName.Replace("." + $fileExtension,"") + "-" + (Remove-InvalidFileNameChars $title.Replace(" ","-")) + ".$fileExtension")            if ($mp4fileName.Contains("_"))            {                $pptxFileName = $mp4fileName.Remove($mp4fileName.LastIndexOf("_")) + ".pptx"                $pptxFileNameSaveAs = $mp4fileName.Remove($mp4fileName.LastIndexOf("_")) + "-" + (Remove-InvalidFileNameChars $title.Replace(" ","-")) + ".pptx"            }            else            {                $pptxFileName = $mp4fileName.Remove($mp4fileName.LastIndexOf(".")) + ".pptx"                $pptxFileNameSaveAs = $mp4fileName.Remove($mp4fileName.LastIndexOf(".")) + "-" + (Remove-InvalidFileNameChars $title.Replace(" ","-")) + ".pptx"            }            if (![string]::IsNullOrEmpty("$mp4fileName"))            {                "Checking $mp4fileName, we will skip it if it already exists in $($destination)"                #if we have the file from the previous script rename it or delete it                if(Test-Path ($destination + $fileName))                {                        if(!(Test-Path ($destination + $mp4fileName)))                     {                         "Renaming: " + $fileName                        Rename-Item $($destination + $fileName) $($destination + $mp4fileName)                    }                    else                    {                        "Deleting: " + $fileName                        Remove-Item $($destination + $fileName)                    }                }                else                {                    #download media if it doesn't exists                    if(!(Test-Path ($destination + $mp4fileName)))                     {                             $dest = $($destination + $mp4fileName)                        "Downloading: '$url' to '$dest'"                        Start-BitsTransfer $url $dest                    }                }            }            #download pptx if it doesn't exists            if ($channelType -eq "Events") #only attempt to get pptx file for events            {                if (![string]::IsNullOrEmpty("$pptxFileName"))                {                    "Checking $pptxFileName, we will skip it if it already exists in $($destination)"                    $dest = $($destination + $pptxFileNameSaveAs)                    if(!(Test-Path ($dest)))                     {                        $urlToDownload = $url.Remove($url.LastIndexOf("/")) + "/" + $pptxFileName                        "Downloading: '$urlToDownload' to '$dest'"                        Start-BitsTransfer $urlToDownload $dest -ErrorAction SilentlyContinue                    }                }            }        }    }}Write-Output "Done"
```

This script caters for renaming of media files from the old just file name format to including the title in the file name. In order to add this extra script that I used for trimming funny characters from the file names.  

```powershell
#source - http://gallery.technet.microsoft.com/scriptcenter/Remove-Invalid-Characters-39fa17b1Function Remove-InvalidFileNameChars {    <#    .SYNOPSIS    This is a PowerShell function to remove invalid characters from strings to be used as file names.    .DESCRIPTION    The function takes a string parameter called Name and returns a string that has been stripped of invalid file name characters, i.e. *, :, \, /.  The Name parameter will also receive input from the pipeline.    .PARAMETER Name    Specifies the file name to strip of invalid characters.    .INPUTS    Parameter Name accepts System.String objects from the pipeline.    .OUTPUTS    System.String.  Outpus a string object    .EXAMPLE    Remove-InvalidFileNameChars -Name "<This/name\is*an:illegal?filename>"    PS C:\>Thisnameisanillegalfilename    .NOTES    It would be easiest to copy the function from the script file and place it in your profile.  However, you may also dot-source the script to load the function into PowerShell:    i.e. PS C:\>. .\Remove-InvalidFileNameChars.ps1    #>    [CmdletBinding()]    param([Parameter(Mandatory=$true,        Position=0,        ValueFromPipeline=$true,         ValueFromPipelineByPropertyName=$true)]        [String]$Name    )    return [RegEx]::Replace($Name, "[{0}]" -f ([RegEx]::Escape([String][System.IO.Path]::GetInvalidFileNameChars())), '')}
```

Hope this helps others that download Channel 9 videos to watch offline as well ![Smile](https://gordonbeeming.com/images/emoticons/smile.svg)

